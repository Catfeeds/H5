<!DOCTYPE html>
<html>


<head>
    {include file="public/base" /}
		<style>		
			body,.mui-content,.nodetail{
				background: white;
			}
			.mui-row.mui-fullscreen>[class*="mui-col-"] {
				height: 100%;
			}
			.mui-col-xs-9 {
				overflow-y: auto;
				width: 100%;
			}
			
			.mui-segmented-control .mui-control-item {
				line-height: 50px;
				width: 100%;
			}
			
			.mui-control-content {
				display: block;
			}
			
			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
				background-color: #fff;
			}
			.mui-back{
				position: fixed;
				line-height: 30px;
			    width: 30px;
			    height: 30px;
			    margin: 10px;
			    border-radius: 50%;
			   	background: rgba(0,0,0,0.4);
    			color: white;
			    z-index: 11;		    
			}
			.mui-segmented-control.mui-segmented-control-vertical .mui-control-item {
			    display: inline-block; 
			    width: 25%;
			    height: 50px;
    			line-height: 50px;
			    float: left;
			    border-bottom:none!important;
			    border-left-width: 0;
			}
			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
			    color:#F52B9D;
			    border-bottom: 2px solid #F52B9D!important;
			    background: 0 0;
			}
			#segmentedControls {
			    background: rgb(255,255,255);
			    position: fixed;
			    z-index: 10;
			    opacity: 0;			    
			}
			#segmentedControls a:first-child{
				margin-left: 60px;
			}
			.mint-swipe-indicator {
	            background: white;
	            opacity: 1;
	        }
	
	        .mint-swipe-indicator.is-active {
	            background:#F52B9D;
	        }
	
	        .noshow {
	            background: #ccc;
	        }
	        #details{
	        	margin-bottom: 55px;
	        }
	        .group-warp{
	        	width: 100%;
	        	padding:10px;
	        	font-size: 14px;
	        }
	        .group-warp span:last-child{
	        	float: right;
	        }
	        .close {
		        float: right;
				padding: 5px 10px;
			}
	        .specifications_detail,.Parameter_detail{
	        	position: fixed;
	        	bottom: 0px;
	        	z-index: 20;
	        	height: 80%;
	        	width: 100%;
	        	border: 1px solid #eee;
	        	background: white;
	        }
	        .detai_title {
			    padding: 10px 0 10px 126px;
			    position: relative;
			}
			.detai_img {
			    width: 100px;
			    height: 100px;
			    position: absolute;
			    top: -28px;
			    left: 10px;
			    border-radius: 4px;
			    overflow: hidden;
			    border: 1px solid rgba(0,0,0,.1);
			    padding: 1px;
			    background-color: #fff;
			    border-radius: 4px;
			}
			.detai_img img {
			    width: 100%;
			    height: 100%;
			    border-radius: 4px;
			}
			.detai_text {
		        color: #333;
			    font-size: 12px;
			    line-height: 18px;
			    padding-right: 20px;
			}
			.detai_text .price-wrap {
			    width: 210px;
			}
			.detai_text .price-wrap .price {
			    font-family: arial;
			    font-size: 18px;
			    color: #F52B9D;
			    word-wrap: break-word;
			}
			.detai_text .select-info {
			    display: -webkit-box;
			    -webkit-line-clamp: 2;
			    -webkit-box-orient: vertical;
			    height: 36px;
			    overflow: hidden;
			    color: red;
			}
			.detai_text .select-info span {
			    margin-right: 5px;
			}
			.select-close {
			    position: absolute;
			    top: 6px;
			    right: 10px;
			}
			.select-close img{
				width: 20px;
				height: 20px;				
			}
			.detai_main {
			    padding: 0 15px 10px;
			    position: absolute;
			    bottom: 48px;
			    top: 93px;
			    left: 0;
			    right: 0;
			    overflow: auto;
			}
			.main-item{
				border-top: 1px solid rgba(0,0,0,.1);
				border-bottom: 1px solid rgba(0,0,0,.1);
			}
			.detai_main .select_list li {			   
			    padding-top: 15px;
			    border-bottom: 1px solid rgba(0,0,0,.1);
			    padding-bottom: 10px;
			}
			.detai_main .select_list .select_title{
			    color: #888888;
			    font-size: 14px;
			    font-weight: 400;
			    padding-bottom: 10px;
			    padding-top: 10px;
			}
			.select_list .select_list_items a {
			    position: relative;
			    display: inline-block;
			    border: 1px solid #888888;
			    border-radius: 8px;
			    font-size: 13px;
			    margin-right: 15px;
			    color: #333;
			    width: 28%;
			    margin-bottom: 6px;
			    max-height: 35px;
			    line-height: 35px;
			    overflow: hidden;
			    text-align: center;
			}
			.select_list .select_list_items a.active {
			    color: white;
			    border-color: #F52B9D;
			    background: #F52B9D;
			}
			.number-wrap .number-line {
			    padding-bottom: 10px;
			    padding-top: 10px;
			    line-height: 36px;
			}
			.number-wrap label {
			    color: #666;
			    font-size: 13px;
			    font-weight: 400;
			}
			.number-wrap .number {
			    height: 36px;
			    width: 100px;
			    border-radius: 3px;
			    float: right;
			}
			.number-wrap .number button {
				float: left;
			    border: none;
			    outline: 0;
			    padding: 0;
			    line-height: 32px;
			    height: 34px;
			    width: 30px;
			    font-size: 24px;
			    border: 1px solid #f5f5f5;
			    background-color: #f5f5f5;
			}
			.number-wrap .number .decrease {
			    border-right: 1px solid #fff;
			}
			.number-wrap .number .increase {
			    border-left: 1px solid #fff;
			}
			.number-wrap .number .disabled {
			    color: #cfcfcf;
			}
			.number-wrap .number input[type=number] {
				float: left;
			    line-height: 32px;
			    height: 34px;
			    width: 36px;
			    text-align: center;
			    font-size: 13px;
			    font-weight: 700;
			    border: 1px solid #f5f5f5;
			    background-color: #f5f5f5;
			    box-sizing: border-box;
			    margin: 0;
			    padding: 0;
			}
			.detai_footer{
				display: block;
			    display: -webkit-box;
			    display: flex;
			    height: 48px;
			    text-align: center;
			    line-height: 48px;
			    color: #FFF;
			    width: 100%;
			    position: absolute;
			    bottom: 0;
			}
			.detai_footer a{
				background: #F52B9D !important;
			    color: #FFF;
			    font-size: 16px;
			    text-align: center;
			    border: 1px solid #F52B9D;
			}
			.detai_footer a.addcart{
				background: #FBAA1C!important;
			    color: #FFF;
			    text-align: center;
			    border: 1px solid #FBAA1C;
			}
			.s_mask,.p_mask,.peishi_mask{
				position: fixed;
			    width: 100%;
			    height: 100%;
			    right: 0;
			    z-index: 19;
			    background: #000000;
			    opacity: 0.5;
			    overflow: auto;
			}
			.Parameter_detail{
				height: 60%;
			}
			.Parameter_main{
				bottom: 48px;
			}
			.top_title h2{
				font-size: 14px;
			    padding: 10px;
			    color: #555;
			}
			.Parameter_detail .detai_main{
				top: 40px;
			}
			.Parameter_detail .detai_main .select_list li {
			    padding: 5px 0;
			}
			.Parameter_detail .detai_main .select_list li:last-child{
				border-bottom: none;
			}
			.Parameter_detail  .title_text {
			    color: #666;
			    width: 20%;
			    float: left;
			    overflow: hidden;
			    font-size: 13px;
			    font-weight: 400;
			    line-height: 30px;
			}
			.Parameter_detail .select_list_items{
				width: 80%;
				float: right;
			}
			.Parameter_detail .select_list_items span{
				margin-right: 10px;
    			font-size: 12px;
    			line-height: 30px;
			}
			#content2{
				padding: 10px;
				color: black;				
			}
			#content2 ul li{
				font-size: 12px;
				color: #999999;
				padding: 10px;
				border-bottom: 1px solid #eee;
			}
			.eval_top{
				margin-bottom: 10px;
			}
			.eval_user_msg{
				width: 100%;
			    height: 35px;
			    line-height: 35px;			    
			}
			.eval_user_img{
				float: left;
			    width: 35px;
			    height: 35px;
			    text-align: center;
			    line-height: 35px;
			    background: #F52B9D;
			    border-radius: 50%;
			    margin-right: 10px;
			}
			.eval_user_img .icon {
			    width: 60%;
			    height: 60%;
			    color: white!important;
			    font-size: 55px;
			}
			.eval_user_name{
				float: left;
			}
			.eval_user_score{
				float: right;
			}
			.eval_content{
				color: black;
				line-height: 20px;			    
			    margin: 10px 0px;
			}
			.look_eval_list{
				padding: 10px 0px;
				text-align: center;
				margin-top: 10px;
				font-size: 12px;
			}
			.look_eval_list a{
				color: #F52B9D;
			    padding: 6px 15px;
			    border-radius: 40px;
			    border: 1px solid #F52B9D;
			}
			#content3{
				/*padding: 10px;*/
				background: #EEEEEE;
				text-align: center;
			}
			#content3 img{
				max-height: 150px;
			    max-width: 100%;
			    min-width: 100%;
			    min-height: 150px;
			    margin-bottom: 5px;
			    border-radius: 10px;
			    border: 1px solid #eee;
			}
			.goodscontent{
				background: white;
			}
			.end,.content_title,.nolist,.nopei{
				padding: 20px 0px;
				text-align: center;
				background: #EEEEEE;
				font-size: 14px;
  				color: #999999;
			}
			.content_title,.nodetail{
				padding: 10px 0px;
			}
			.nolist{
				background: white;
			}
			.cartLogo{
				position: fixed;
			    line-height: 35px;
			    text-align: center;
			    width: 30px;
			    height: 30px;
			    margin-top: 10px;
			    margin-left: 90%;
			    border-radius: 50%;
			    background: rgba(0,0,0,0.4);
			    color: white;
			    z-index: 11;
			}
			.cartLogo .icon{
				width: 70%;
    			height: 70%;
			}
			.imgBroadcast{
				width: 100%;
				height: 250px;
				overflow: hidden;
			}
			.imgBroadcast img{
				width: 100%;
				height: 100%;
			}
			.mui-btn-blue, .mui-btn-primary, input[type=submit] {
			    color: #fff;
			    border: 1px solid #F52B9D;
			    background-color: #F52B9D;
			}
			.peishi_list_top li,
			.peishi_box .detai_main ul li{
			    width: 20%;
			}
		</style>
	</head>

	<body>
		
		<div class="mui-content mui-row mui-fullscreen"  id="details" v-cloak>	
			<a class="mui-icon mui-icon-left-nav mui-pull-left mui-back" @click="back"></a>			
			<a class="mui-icon mui-pull-right cartLogo" href="{:url('cart/index')}">
				<svg class="icon" aria-hidden="true" style="font-size: 26px;">
                    <use xlink:href="#icon-gouwuche1-copy"></use>
                </svg>
			</a>
			<div id="segmentedControls" class="mui-segmented-control mui-segmented-control-inverted mui-segmented-control-vertical">
				
				<a class="mui-control-item mui-active" data-index="0" href="#content1">商品</a>
				<a class="mui-control-item" data-index="1" href="#content2">评价</a>
				<a class="mui-control-item" data-index="2" href="#content3">详情</a>
			</div>
			<div id="segmentedControlContents" class="mui-col-xs-9" style="border-left: 1px solid #c8c7cc;">
				<div id="content1" class="mui-control-content">
					<!--轮播-->
		            <div class="imgBroadcast" v-if="thumb !== null || thumb !== ''">
		                <img :src="thumb" width="100%" height="100%" />
		                
		            </div>
		            <div class="imgBroadcast" v-else>
		            	<img src="__IMG__/zuanjie.png" width="100%" height="100%"/>
		            </div>
		
		            <!--产品详情-->
		            <div class="goods_name clear">
		                <p>{{goodsMsg.name}}</p>
		                <p class="new_price">
		                	<span>￥</span>
		                	<span v-text="goodsPrice"></span>
		                </p>
		                <p class="tagStr">
		                	<span v-if="tagStr !== null" v-text="tagStr.replace(/,/g, '')"></span>
		                </p>
		            </div>
		            <div class="black"> </div>
		            <!--产品规格-->
		            <div class="group-warp pro_specifications" @click="Showspecifications">
		            	<span>请选择产品规格</span>
		            	<span class="mui-icon mui-icon-more"></span>
		            </div>	
		            <div class="black"> </div>
		            <!--产品参数-->	
		            <div class="group-warp pro_parameter" @click="parameter">
		            	<span>产品参数</span>
		            	<span class="mui-icon mui-icon-more"></span>
		            </div>	
		            <div class="black"> </div>
		         
				</div>
				<div id="content2" class="mui-control-content">
					<div class="eval_top">
						商品评价（{{evalList.length}}）
					</div>
					<ul  v-if="evalList.length>0">
						<li v-for="(item,index) in evalList"  v-if="index<2">
							<div class="eval_user_msg">
								<div class="eval_user_img">
									<svg class="icon" aria-hidden="true">
			                            <use xlink:href="#icon-icon_Buyers-certification"></use>
			                        </svg>
								</div>
								<div class="eval_user_name">
									匿名
								</div>
								<span class="eval_user_score" >
									<span v-for="index in item.score" v-id="index">
										<svg class="icon" aria-hidden="true" >
				                            <use xlink:href="#icon-star"></use>
				                       </svg>				                        
									</span>
								</span>
							</div>
							<div class="eval_content mui-ellipsis-2" v-text="item.content"></div>
							<div class="eval_time" v-text="item.create_time"></div>
						</li>	
						<div class="look_eval_list">
							<a :href="'{:url('goods/evaluation')}?goods_id='+id">查看更多评价</a>
						</div>
					</ul>
					<div class="nolist" v-else>
			        	该商品暂无评价！
			        </div>
				</div>
				
				<div id="content3" class="mui-control-content">	
					<div class="content_title">————— 商品详情 —————</div>
					<div class="goodscontent" v-if="goodsMsg.content">
						<div class="" v-html="goodsMsg.content">						
						</div>
					</div>
					<div class="nodetail" v-else>
						<p>
							暂无商品详细信息
						</p>
						<p>敬请等待，后期更新</p>
					</div>
					<div class="black"> </div>
					<div class="end">————— 已经到底了 —————</div>
				</div>
				
			</div>
			<!-- 区分成品还是定制 若为成品可以立即购买 若为定制商品需要选择配托 -->
	        <div class="nav_footer mui-row">
	        	<span class="mui-col-sm-6 mui-col-xs-6 footer_left">
	            	<a href="{:url('com/kefu')}" class="mui-col-sm-4 mui-col-xs-4" style="border-right: 1px solid #CCCCCC;">
	                    <span class="icon_style">
	                    	<svg class="icon" aria-hidden="true" style="font-size: 26px;">
	                            <use xlink:href="#icon-kefu"></use>
	                        </svg>
	                    </span>
	                    <span>客服</span>
	                </a>
	                <a href="javascript:void(0);" class="mui-col-sm-4 mui-col-xs-4 collect" @click="collect" style="border-right: 1px solid #CCCCCC;">
	                    <span class="icon_style">
	                        <svg class="icon cf" aria-hidden="true" style="font-size: 26px;">
	                            <use xlink:href="#icon-shoucangxing"></use>
	                        </svg>
	                        <svg class="icon ct" aria-hidden="true" style="font-size: 26px;color: red;display: none;">
	                            <use xlink:href="#icon-shoucangxing2"></use>
	                        </svg>
	                    </span>
	                    <span>收藏</span>
	                </a>
	                <a href="{:url('cart/index')}" class="mui-col-sm-4 mui-col-xs-4">
	                    <span class="icon_style">
	                        <svg class="icon" aria-hidden="true" style="font-size: 26px;">
	                            <use xlink:href="#icon-gouwuche1-copy"></use>
	                        </svg>
	
	                    </span>
	                    <span>购物车</span>
	                    <span class="mui-badge mui-badge-danger my-badge">{{cartnum}}</span>
	                </a>
	            </span>
	            <span  class="mui-col-sm-6 mui-col-xs-6">
	            	<!--<a href="javascript:void(0);" class="mui-col-sm-6 mui-col-xs-6 click_cart"  @click="Showspecifications">
	                    <span>加入购物车</span>
	               </a>-->
		            <a href="javascript:void(0);" class="mui-col-sm-12 mui-col-xs-12 custom-btn" @click="Showspecifications">
		                <span>在线配石</span>
		            </a>
	            </span>
	        </div>
			
			<!--规格选项弹框-->
			<div v-show="specificationsdetailsShow">
				<div class="s_mask" @click="buttom_alert"></div>
				<div class="specifications_detail">					
	            	<div class="detai_title">
	            		<div class="detai_img">
	            			<img :src="thumb" class="w4rem" alt="">
	            		</div>
	            		<div class="detai_text">
	            			<div class="pro-name" style="line-height: 40px;font-size: 16px;">
	            				{{goodsMsg.name}}
	            			</div>
	            			<div class="price-wrap">
	            				<span class="price">
	            					<span>￥</span>
		                			<span v-text="goodsPrice"></span>
	            				</span>
	            			</div>
	            			
	            			<!--<div class="select-info" v-show="goodstype == 4">
	            				   该商品限购1件
	            			</div>-->
	            		</div>
	            		<span class="select-close"  @click="buttom_alert">
		            		<img src="__IMG__/close.png"/>
		            	</span>
	            	</div>
	            	<div class="detai_main">
	            		<div class="main-item">
	            			<ul class="select_list">
	            				<li>
	            					<h2 class="select_title">可选材质</h2>
	            					<div class="select_list_items">
	            						<a href="javascript:void(0);"  v-for="(item,index) in caiziList" @click="liListClick(index)" :class="{active:index == isactive}">
	            							{{item.material_name}}
	            						</a>         					
	            					</div>
	            				</li>
	            				<li v-show="ifShoucun" >
			                 		<h2 class="select_title">{{shoucunName}}</h2>
		                        	<div class="select_list_items">
	            						<a href="javascript:void(0);" @click="showShouCun" class="active">
	            							{{shoucun}}
	            						</a>	            					
	            					</div>
		                            
		                        </li>
			                 	<li v-if="zhushiList">
			                 		<h2 class="select_title">可选主石</h2>
		                        	<div class="select_list_items">
	            						<a v-for="(item,index) in zhushiList" @click="changeshape(index)" :class="{active:index == isActive}">
	            							{{item.luozuan_shape_name}} {{item.luozuan_weight}}CT
	            						</a>	            					
	            					</div>
		                            
		                        </li>
	            				
	            			</ul>
			                
	            			<div class="number-wrap">
	            				<div class="number-line">
	            					<label>购买数量</label>
	            					<div class="number">
	            						<button class="decrease disabled" @click="pro_num_jian">-</button>
	            						<input type="number" v-model="goods_num" disabled/>
	            						<button class="increase" @click="pro_num_jia">+</button>
	            					</div>
	            				</div>
	            			</div>
	            		</div>
	            	</div>
					<div class="detai_footer">
						<!--<a href="javascript:void(0);" class="mui-col-sm-6 mui-col-xs-6 addcart" @click="addcart">
		                    <span>加入购物车</span>
		                </a>-->

			            <a href="javascript:void(0);" class="mui-col-sm-12 mui-col-xs-12 custom-btn"@click="xtdPeishi">
			                <span>在线配石</span>
			            </a>
					</div>
				</div>
			</div>
			<!--参数详情弹框-->
			<div v-show="parameterdetailsShow">
				<div class="p_mask" @click="buttom_alert"></div>
				<div class="Parameter_detail">
					<div class="top_title">
						<h2>参数详情</h2>
					</div>
					<div class="detai_main">
						<div class="main-item">
							<ul class="select_list">
								<li class="clear">
									<h2 class="title_text">商品名称</h2>
									<div class="select_list_items">
	            						<span>{{goodsMsg.name}}</span>
	            					</div>
								</li>
								<li class="clear">
									<h2 class="title_text">商品价格</h2>
									<div class="select_list_items">
	            						<span>￥ {{goodsPrice}}</span>
	            					</div>
								</li>
								<li class="clear">
									<h2 class="title_text">商品编号</h2>
									<div class="select_list_items">
	            						<span>{{goodsMsg.code}}</span>
	            					</div>
								</li>
								<li class="clear">
									<h2 class="title_text">上新时间</h2>
									<div class="select_list_items">
	            						<span>{{goodsMsg.create_time}}</span>
	            					</div>
								</li>
								<li class="clear">
									<h2 class="title_text">商品类型</h2>
									<div class="select_list_items">
	            						<span v-if="goodsMsg.type==0">白钻</span>
	            						<span v-if="goodsMsg.type==1">彩钻</span>
	            						<span v-if="goodsMsg.type==2">散货</span>
	            						<span v-if="goodsMsg.type==3">成品</span>
	            						<span v-if="goodsMsg.type==4">定制</span>
	            					</div>
								</li>
	            				<!--<li class="clear"  v-for="(item,index) in goodsAttr">
	            					<h2 class="title_text">{{item.attrname}}</h2>
	            					<div class="select_list_items">
	            						<span v-for="(list) in goodsAttr[index].sub_attr_id">{{list.attrvaluename}}</span>
	            					</div>
	            				</li>-->
	            				
	            			</ul>
						</div>
					</div>
					<div class="detai_footer">
						<a href="javascript:void(0);" @click="buttom_alert" style="width: 100%;">确定</a>
					</div>
				</div>
			</div>
			<!-- 点击配托弹出层 -->
	        <div v-show="detailsShow">
	            <div class="peishi_mask" @click="buttom_alert"></div>
		            <div class="peishi_box">
		                <div v-if="peishiList.length>0">
		                	<div class="top_title clear">
								<h2>在线配石</h2>
								<div class="select-close"  @click="buttom_alert_specificationsdetailsShow">
				            		<img src="__IMG__/close.png"/>
				            	</div>
								<ul class="peishi_list_top clear">
									<li>形状</li>
				                    <li>钻重</li>
				                    <li style="width: 15%;">净度</li>
				                    <li>颜色</li>
				                    <li style="width: 25%;">价格</li>
				                </ul>
							</div>
			                <div class="detai_main">	                	
				                <ul class="clear" v-for="(item,index) in peishiList" @click="selectDiamond(index)" :class="{active:index == isActivee}">
				                	
				                    <li>{{zhushiList[isActive].luozuan_shape_name}}</li>
				                    <li>{{zhushiList[isActive].luozuan_weight}}</li>
				                    <li style="width: 15%;">{{item.clarity}}</li>
				                    <li>{{item.color}}</li>
				                    <li style="width: 25%;">￥ {{item.price_seller}}</li>
				                </ul>
			                </div>
			                <div class="detai_footer">
			                    <a href="javascript:void(0);" class="mui-col-sm-3 mui-col-xs-3 custom-btn" style="width:100%" @click="pipei">
			                        <span>确认匹配</span>
			                    </a>
			                </div>
		                </div>
		                <div class="nopei" v-else>
			            	没有可匹配钻石
			            </div>
	                </div>
	                
	            
	        </div>
	        <!-- 当确认匹配显示所选的托和匹配到的钻 -->
	        <div class="matching" v-show="isShow">
	            <div class="buttom_alert" @click="buttom_alert"></div>
	            <div class="queRen">
	            	<div class="top_title">
						<p>精品定制</p>
						<div class="select-close"  @click="buttom_alert_detailsShow">
		            		<img src="__IMG__/close.png"/>
		            	</div>
					</div>
	                <div class="detai_main tops">
	                    <ul class="ma-box clear">
	                        <li class="clear">
	                            <div class="fl good-img">
	                                <img :src="thumb" class="w4rem" alt="">
	                            </div>
	                            <div class="good-title">
	                                <p class="good-title_top">
	                                    <span>{{goodsName}}</span>
	                                    <button @click="ringAgain">重选</button>
	                                </p>
	                                <p>{{material_name}}</p>
	                                <p class="rmb"></p>
	                                <p class="rmb">
	                                	<span class="rmb_price">￥{{goodsPrice}}</span>
	                                	<span class="rmb_num">数量：X {{goods_num}}</span>
	                                </p>
	                            </div>
	                            <div class="clearfix"></div>
	                        </li>
	
	                        <li class="clear">
	                            <div class="fl good-img">
	                                <img src="__IMG__/zuanjie.png" class="w4rem" alt="">
	                            </div>
	                            <div class="good-title">
	                                <p class="good-title_top">
	                                    <span></span>
	                                    <button @click="diamondAgain">重选</button>
	                                </p>
	                                <p>{{luozuan_shape_name}}&nbsp;{{weight}}&nbsp;{{peishiClarity}}&nbsp;{{peishiColor}}</p>
	                                <p class="rmb">
	                                	<span class="rmb_price">￥{{peishiPrice}}</span>
	                                	<span class="rmb_num">数量：X <span v-text="luozuan_number*goods_num"></span></span>
	                                </p>
	                            </div>
	                            <div class="clearfix"></div>
	                        </li>
	                        <div class="clearfix"></div>
	                    </ul>	                    
	                	<div class="detai_main_foot">
	                		共2件商品，总价：<span class="rmb_price">￥<span v-text="goodsPrice*goods_num + peishiPrice*luozuan_number*goods_num"></span></span>
	                	</div>
	                </div>
	                <div class="detai_footer">
	                	<a href="javascript:void(0);" class="mui-col-sm-6 mui-col-xs-6 addcart" @click="queRenButton(0)">
		                    <span>加入购物车</span>
		                </a>

			            <a href="javascript:void(0);" class="mui-col-sm-6 mui-col-xs-6" @click="queRenButton(1)">
			                <span>立即购买</span>
			            </a>
                    	<!--<a class="custom-btn" @click="queRenButton">确认定制</a>-->
                    </div>
	            </div>
	        </div>
		</div>		
		
	</body>
	<script>
	mui.init({
		swipeBack: true //启用右滑关闭功能
	});
	Vue.use(VueLazyload, {
        preLoad: 1.3,
        error: "__IMG__/timg_01.gif",
        loading: '__IMG__/timg_01.gif',
        attempt: 1
    });

    let picker = new mui.PopPicker({
        layer: 1
    });
    picker.hide();

    // 定义过滤器
    Vue.filter('keepTwoNum', function (value) {
        value = Number(value);
        return value.toFixed(2);
    })

    let vm = new Vue({
        el: '#details',
        components: {},
        data() {
            return {
            	number: 0,
                goods_num: 1,
                id: '',
                goodsName: '', //商品名称
                goodsPrice: '', //商品价格
                goodsCode: '', //商品编号
                goodsStockNum: '', //库存
                token: '',
                goodsAttr: [],
                zhushiList: [], // 可选主石
                caiziList: [], // 可选材质
                shoucunList: [], // 手寸
                shape: '',
                weight: '',
                isactive: 0, //材质默认选中
                thumb: '', // 缩略图
                isActive: 0, //主石默认选中
                detailsShow: false,
                peishiList: "",
                shoucunName: '',
                shoucun: '',
                goods_id: 0, //商品ID
                material_id: 0, //商品材质ID
                material_name: '',
                luozuan_ids: 0, //主石ID
                luozuan_shape_name: '',
                luozuan_number:'',
                isActivee: -1, //主石列表排序
                peishi_id: 0,
                isShow: false,
                peishiClarity: '', //下单通配石净度
                peishiColor: '', //下单通配石颜色
                peishiPrice: '', //下单通配石价格
                type: 0, //购物车类型  1为立即购买
                goodsIdList: [], // 收藏列表
                goodsIdList01: [],
                cartnum: 0, // 购物车数据
                ifShoucun: true,
            	goodsMsg:[],
            	tagStr:'',
            	evalList:[],//评价列表
            	specificationsdetailsShow:false,//规格选项详情显示
                parameterdetailsShow:false//参数详情详情显示

               
            }
        },
        filters: {
            //保留2位小数点过滤器 不四舍五入
            number(value) {
                let toFixedNum = Number(value).toFixed(3);
                let realVal = toFixedNum.substring(0, toFixedNum.toString().length - 1);
                return realVal;
            }
        },
        created() {
            this.token = getToken();
            this.id = getUrlParam("id");
			 var _this = this
                     
            /*获取下单通商品详情*/
            axios.get(__apiurl2 + '/goods/getxdtinfo', {
                params: {
                    id: this.id,
                },
                headers: {
                    Aid: getAId()
                },
            }).then(function(res){
            	console.info(res);
            	vm.goodsMsg = res.data.data;
            	vm.tagStr = res.data.data.tagStr;
                console.info(vm.tagStr);
                if(vm.tagStr){
                	$(".tagStr").css("opacity","1");
                }else{
                	$(".tagStr").css("opacity","0");
                }
                vm.goodsName = res.data.data.name; //商品名称
                vm.goodsPrice = res.data.data.price_seller.replace(/,/g, ''); //商品价格
                vm.thumb = res.data.data.thumb; //商品图片
                vm.goodsStockNum = res.data.data.stock_num; //商品库存
                vm.goodsCode = res.data.data.code; //商品编号

                vm.goodsAttr = res.data.data.GoodsXdt;
                vm.zhushiList = vm.goodsAttr.extra_goods_luozuan //下单通主石
                vm.caiziList = vm.goodsAttr.extra_goods_materials //下单通材质
                vm.shoucunList = vm.goodsAttr.extra_goods_size.values //下单通手寸
                vm.shoucunName = vm.goodsAttr.extra_goods_size.label; //手寸名称
                
                // 默认第一个
                vm.goods_id = res.data.data.supply_goods_id //对应的第一个商品ID
                vm.material_id = vm.goodsAttr.extra_goods_materials[0].material_id //对应的第一个材质ID
                vm.material_name = vm.goodsAttr.extra_goods_materials[0].material_name //对应的第一个材质ID
                vm.luozuan_ids = vm.goodsAttr.extra_goods_luozuan[0].associate_luozuan_id //对应的第一个主石ID
                vm.luozuan_shape_name = vm.goodsAttr.extra_goods_luozuan[0].luozuan_shape_name //对应的第一个主石ID
                vm.luozuan_number = vm.goodsAttr.extra_goods_luozuan[0].luozuan_number //对应的第一个主石ID
                vm.weight = vm.zhushiList[0].luozuan_weight //对应的第一个主石钻重ID
                
                // 默认显示第一个手寸,并且判断是否有手寸
                if (vm.shoucunList.length != 0) {
                    var obj = [];
                    for (var i = 0;i<vm.shoucunList.length;i++) {
                        var tmp = {
                            value: vm.shoucunList[i],
                            text: vm.shoucunList[i]
                        };
                        obj.push(tmp);
                    }
                    vm.shoucun = obj[0].value;

                    picker.setData(obj)
                } else {
                    vm.ifShoucun = false;
                }
                 vm.getxdtprice();
            }).catch(function(error){
                mui.alert(error)
            })
            /*商品评价*/
			axios.get(__apiurl + '/order/evalList', {
                params: {
                    goods_id: this.id
                },
                headers: {
                    Aid: getAId()
                }
          }).then(function (response) {          		
          		//console.info(response);
                if (response.status == 200) {                	
                   if(response.data.data){
                   	 vm.evalList = response.data.data;
                   }
                }
            }).catch(function (error)  {
                mui.alert(error)
            })
            
            //购物车数据  只取购物车总数
            axios({
                method: 'GET',
                url: __apiurl2 + '/cart/index',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    Token: this.token,
                    Aid: getAId()
                },
            }).then(function(res){
            	//console.log(res);            	
                if (res.data.status == 100) {                    
                    vm.cartnum = res.data.data.total_num;
                }
            }).catch(function(error){
                mui.alert(error)
            })
          
            //获取收藏列表
            axios({
                method: 'POST',
                url: __apiurl + '/user/getUserGoodsCollectionList',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    Token: this.token,
                    Aid:getAId()
                },
            }).then(function(res){
               // var _this = this;
                vm.goodsIdList = res.data.data.data;

                //console.log(vm.goodsIdList)             
                for(var i=0;i<vm.goodsIdList.length;i++){
                	//newarray = ;
                	vm.goodsIdList01.push(vm.goodsIdList[i].goods_id);
                }	
                if (in_array(vm.id, vm.goodsIdList01)) { //判断this.id是否在数组中
                    $(".ct").css("display","inline-block");
	                $(".cf").css("display","none");
                }else{
                	$(".ct").css("display","none");
                    $(".cf").css("display","inline-block");
                }
            }).catch(function(error){
                mui.alert(error)
            })
           
        },
        methods: {
        	back:function(){
        		console.info(getUrlParam("url"))
        		window.location.href = getUrlParam("url")+'&goods_type=5';
        	},
           liListClick: function (index) {
                vm.isactive = index;
                vm.material_id = vm.caiziList[index].material_id //根据所选材质来决定商品
                vm.material_name = vm.caiziList[index].material_name
                vm.getxdtprice();
                // console.log(this.caiziList)
            },
            changeshape: function (index) {
                this.isActive = index;
                this.getxdtprice();
                this.luozuan_ids = this.zhushiList[index].associate_luozuan_id //根据所选主石来决定主石
                this.luozuan_shape_name = this.zhushiList[index].luozuan_shape_name //根据所选主石来决定主石名称
                this.weight = this.zhushiList[index].luozuan_weight //根据所选主石来决定主石重量
                this.getxdtprice();
            },


            // 点击手寸，弹出picker选择器
            showShouCun: function () {
                picker.show(function (SelectedItem) {
                    vm.shoucun = SelectedItem[0].text;
                })
            },

            // 获取sku
            getxdtprice: function () {
                var _this = this
                axios.get(__apiurl2 + '/goods/getxdtprice', {
                    params: {
                        goods_id: vm.goods_id,
                        material_id: vm.material_id,
                        luozuan_ids: vm.luozuan_ids
                    },
                    headers: {
                        Aid: getAId()
                    },
                }).then(function (res) {

                    if (res.data.status == 100) {
                        vm.goodsPrice = res.data.data.price_seller.replace(/,/g, ''); //获取sku的价格
                    }
                }).catch(function (error) {
                    mui.alert(error)
                })

            },
            
            pro_num_jian() {
                if (vm.goods_num <= 1) { 
                	$(".decrease").addClass("disabled");
                	mui.toast('已经不能再少了')
                    vm.goods_num = 1;
                    return
                }
                vm.goods_num--;
            },
            pro_num_jia() {
               vm.goods_num++;
            },
            // 下单通在线配石
            xtdPeishi: function () {
                var that = vm;
                //that.detailsShow = false
                that.specificationsdetailsShow = false;
                axios({
                    url: __apiurl2 + '/goods/getxdtmatch',
                    method: "get",
                    params: {
                        weight: that.weight
                    },
                    headers: {
                        Aid: getAId()
                    },
                }).then(function (res) {
                    if (res.data.status == 100) {
                        that.detailsShow = true;
                        that.peishiList = res.data.data;
                        console.log(that.peishiList)
                        // 默认第一个配石
                        this.peishiClarity = that.peishiList[0].clarity //下单通配石净度
                        this.peishiColor = that.peishiList[0].color //下单通配石颜色
                        this.peishiPrice = that.peishiList[0].price_seller.replace(/,/g, ''); //下单通配石价格
                    } else {
                        mui.alert("没有可匹配主石")
                    }
                })
            },
            // 在线配石
            selectDiamond: function (index) {
                var _this = vm;
                vm.isActivee = index;
                vm.peishi_id = vm.peishiList[index].id;
                vm.peishiClarity = vm.peishiList[index].clarity //下单通配石净度
                vm.peishiColor = vm.peishiList[index].color //下单通配石颜色
                vm.peishiPrice = (vm.peishiList[index].price_seller.replace(/,/g, '') * vm.weight).toFixed(2) //下单通配石价格
                //console.log(_this.peishiPrice)

            },
            // 确认匹配
            pipei: function () {
            	if($(".peishi_box .detai_main ul.active").length>0){
            		this.detailsShow = false;
                	this.isShow = true;
            	}else{
               		mui.alert("请选择匹配的钻石");
               }
            	
                
            },
            // 戒指重选
            ringAgain: function () {
                history.go(-1);
            },
            // 钻石重选
            diamondAgain: function () {
                if (this.peishi_id = null) {
                    window.location.href = "{:url('Goods/diamond')}";
                } else {
                    this.detailsShow = true;
                    this.isShow = false;
                }
            },
            // 确认定制后提交到购物车
            queRenButton: function (index) {
                var that = this
                that.stone_name = this.luozuan_shape_name + this.weight
                //console.log(that.stone_name)
                axios({
                    url: __apiurl + '/cart/xdtaddcart',
                    headers: {
                        Accept: "application/json; charset=utf-8",
                        Token: that.token,
                        Aid:getAId()
                    },
                    method: "POST",
                    data: {
                        hand_name: that.shoucunName,
                        hand: that.shoucun,
                        goods_num: that.goods_num,
                        goods_id: that.id,
                        stone_id: that.luozuan_ids,
                        stone_name: that.stone_name,
                        material_id: that.material_id,
                        material_name: that.material_name,
                        matched_diamond_id: that.peishi_id,
                        jt_price: that.goodsPrice,
                        zs_price: that.peishiPrice,
                        color: that.peishiColor,
                        clarity: that.peishiClarity,
                        type: index
                    }
                }).then(function (res) {
                	console.info(res);
                	if (index == 1) {
                		if(res.data.status == 100){
                			window.location.href = "{:url('order/confirm')}";
                        	return false;
                		}                    
                    }else{
                    	if(res.data.status == 100){
	                		mui.toast(res.data.msg);
	                        this.cartnum += 1;
	                		
	                	}else {
	                        mui.alert(res.data.msg)
	                    }
                    }
                    /*if (res.data.status == 100) {
                        window.location.href = "{:url('cart/index')}";
                    } else {
                        mui.alert(res.data.msg);
                        //window.location.href = "{:url('cart/index')}";
                    }*/
                })
            },

            /*// 加入购物车
            addcart: function () {
                if (this.detailsShow = true) {
                    mui.alert("请选择配石")
                    this.detailsShow = false;
                }
            },*/
            //收藏按钮
            collect() {
                __checkLogin();
                if($(".cf").css("display") == "none"){
                    axios({
                        method: 'POST',
                        url: __apiurl + '/user/delusergoodscollection',
                        headers: {
                            Accept: "application/json; charset=utf-8",
                            Token: this.token,
                            Aid:getAId()
                        },
                        data: {
                            goods_id: this.id
                        }
                    }).then(function(res){
                        if (res.data.status == 100) {
                             mui.toast(res.data.msg);
                            $(".ct").css("display","none");
                        	$(".cf").css("display","inline-block");
                        }
                    }).catch(function(error){
                        console.log(error)
                    })
                } else {
                    axios({
                        method: 'POST',
                        url: __apiurl + '/user/addusergoodscollection',
                        headers: {
                            Accept: "application/json; charset=utf-8",
                            Token: this.token,
                            Aid:getAId()
                        },
                        data: {
                            goods_id: this.id
                        }
                    }).then(function(res){
                        if (res.data.status == 100) {
                            mui.toast(res.data.msg);
                            $(".ct").css("display","inline-block");
                        	$(".cf").css("display","none");
                        }
                        console.log(res)
                    }).catch(function(error){
                        console.log(error)
                    })
                }
                // }

            },

            parameter(){
                this.parameterdetailsShow= true;
            },
			Showspecifications(){				
				this.specificationsdetailsShow = true;
				this.iss_mask = true;
			},
			buttom_alert_detailsShow(){
				this.detailsShow = true;
				this.isShow = false;
				
			},
			buttom_alert_specificationsdetailsShow(){
				this.specificationsdetailsShow = true
				this.detailsShow = false;
			},
            buttom_alert() {
            	this.detailsShow = false;
            	this.parameterdetailsShow= false;
            	this.specificationsdetailsShow = false;
                this.isShow = false;
            },
           

   
        }
    });


    //判断是否在数组里面
    function in_array(search, array) {
        for (var i in array) {
            if (array[i] == search) {
                return true;
            }
        }
        return false;
    }

		setTimeout(
			(function() {
				var controlsElem = document.getElementById("segmentedControls");
				var contentsElem = document.getElementById("segmentedControlContents");
				var controlListElem = controlsElem.querySelectorAll('.mui-control-item');
				var contentListElem = contentsElem.querySelectorAll('.mui-control-content');
				var controlWrapperElem = controlsElem;
				var controlWrapperHeight = controlWrapperElem.offsetHeight;
				
				var controlMaxScroll = controlWrapperElem.scrollHeight - controlWrapperHeight;//左侧类别最大可滚动高度
				//console.info(controlMaxScroll)
				var maxScroll = contentsElem.scrollHeight - contentsElem.offsetHeight;//右侧内容最大可滚动高度
				
				
				var controlHeight = controlListElem[0].offsetHeight;//左侧类别每一项的高度
				var controlTops = []; //存储control的scrollTop值
				var contentTops = [0]; //存储content的scrollTop值
				var length = contentListElem.length;
				for (var i = 0; i < length; i++) {
					controlTops.push(controlListElem[i].offsetTop + controlHeight);
				}				
				for (var i = 1; i < length; i++) {
					var offsetTop = contentListElem[i].offsetTop;
					if (offsetTop + 100 >= maxScroll) {
						var height = Math.max(offsetTop+100 - maxScroll, 100);
						var totalHeight = 0;
						var heights = [];
						for (var j = i; j < length; j++) {
							var offsetHeight = contentListElem[j].offsetHeight;
							totalHeight += offsetHeight;
							heights.push(totalHeight);
						}
						for (var m = 0, len = heights.length; m < len; m++) {
							contentTops.push(parseInt(maxScroll - (height - heights[m] / totalHeight * height)));
						}
						break;
					} else {
						contentTops.push(parseInt(offsetTop));
					}
				}
				//console.info(contentTops)
				contentsElem.addEventListener('scroll', function() {
					var scrollTop = contentsElem.scrollTop+60;
					//改变top的rgba
			        var t = document.getElementById("segmentedControlContents").scrollTop; //获取距离页面顶部的距离
			        //alert(t);
			        //如果小于220像素改变rgba
			        var changeRgba = (t / 200) > 1 ? 1 : t / 200;
			        var changeRgba1 = (t / 200) > 1 ? 0 : 0.4;
			        document.getElementById("segmentedControls").style.opacity = changeRgba;		        
			        if(t>100){
			        	document.getElementsByClassName("mui-back")[0].style.background = 'rgba(0,0,0,0)';
			        	document.getElementsByClassName("mui-back")[0].style.color = "#000000";
			        	document.getElementsByClassName("cartLogo")[0].style.background = 'rgba(0,0,0,0)';
			        	document.getElementsByClassName("cartLogo")[0].style.color = "#000000";
			        	
			        }else{
			        	document.getElementsByClassName("mui-back")[0].style.background = 'rgba(0,0,0,0.4)';
			        	document.getElementsByClassName("mui-back")[0].style.color = "white";
			        	document.getElementsByClassName("cartLogo")[0].style.background = 'rgba(0,0,0,0.4)';
			        	document.getElementsByClassName("cartLogo")[0].style.color = "white";
			        }
			        
					for (var i = 0; i < length; i++) {
						var offsetTop = contentTops[i];
						var offset = Math.abs(offsetTop - scrollTop);
						//console.info(offset)
						if (scrollTop < offsetTop) {
							if (scrollTop >= maxScroll) {
								onScroll(length - 1);
							} else {
								onScroll(i - 1);
							}
							break;
						} else if (offset < 20) {
							onScroll(i);
							break;
						}else if(scrollTop >= maxScroll){
							onScroll(length - 1);
							break;
						}
					}
				});
				var lastIndex = 0;
				//监听content滚动
				var onScroll = function(index) {
					
					if (lastIndex !== index) {
						lastIndex = index;
						var lastActiveElem = controlsElem.querySelector('.mui-active');
						lastActiveElem && (lastActiveElem.classList.remove('mui-active'));
						var currentElem = controlsElem.querySelector('.mui-control-item:nth-child(' + (index + 1) + ')');
						currentElem.classList.add('mui-active');
						//简单处理左侧分类滚动，要么滚动到底，要么滚动到顶
						var controlScrollTop = controlWrapperElem.scrollTop;
						//console.info(controlScrollTop)
						if (controlScrollTop + controlWrapperHeight < controlTops[index]) {
							controlWrapperElem.scrollTop = controlMaxScroll-controlWrapperHeight;
						} else if (controlScrollTop > controlTops[index] - controlHeight) {
							controlWrapperElem.scrollTop = 0;
						}
					}
				};
				//滚动到指定content
				var scrollTo = function(index) {
					contentsElem.scrollTop = contentTops[index]-52;
				};
				mui(controlsElem).on('tap', '.mui-control-item', function(e) {
					scrollTo(this.getAttribute('data-index'));
					return false;
				});
			}),500);
		/*监听丢失的图片*/
	    $("img").on('error', function () {
	        $(this).attr('src', '__IMG__/700.jpg');
	    })
	</script>
</html>